// Defina os pinos da ponte H
#define PIN_IN1 5  // Pino IN1 da ponte H
#define PIN_IN2 6  // Pino IN2 da ponte H
#define PIN_ENA 9  // Pino ENA (PWM) da ponte H

#include <Arduino.h>

void setup() {
  // Configure os pinos como saída
  pinMode(PIN_IN1, OUTPUT);
  pinMode(PIN_IN2, OUTPUT);
  pinMode(PIN_ENA, OUTPUT);
}

void analogWrite(int pin, int value) {
  ledcAttachPin(pin, 0); // Canal 0 para controle PWM
  ledcSetup(0, 5000, 8); // Frequência de 5kHz, resolução de 8 bits
  ledcWrite(0, value);   // Ajusta o PWM
}

void loop() {
  // Gira o motor em uma direção, aumentando a velocidade gradualmente
  for (int speed = 0; speed <= 255; speed += 10) { // Incremento maior para atingir velocidade mais rapidamente
    digitalWrite(PIN_IN1, HIGH);
    digitalWrite(PIN_IN2, LOW);
    analogWrite(PIN_ENA, speed);  // Ajusta a velocidade do motor
    delay(100);  // Reduz o tempo de espera para acelerar mais rapidamente
  }

  // Mantém o motor girando na velocidade máxima por 5 segundos
  delay(5000);

  // Para o motor brevemente antes de mudar de direção
  analogWrite(PIN_ENA, 0);
  delay(1000);

  // Gira o motor na direção oposta, aumentando a velocidade gradualmente
  for (int speed = 0; speed <= 255; speed += 10) { // Incremento maior para atingir velocidade mais rapidamente
    digitalWrite(PIN_IN1, LOW);
    digitalWrite(PIN_IN2, HIGH);
    analogWrite(PIN_ENA, speed);  // Ajusta a velocidade do motor
    delay(100);  // Reduz o tempo de espera para acelerar mais rapidamente
  }

  // Mantém o motor girando na velocidade máxima por 5 segundos
  delay(5000);

  // Para o motor brevemente antes de repetir o ciclo
  analogWrite(PIN_ENA, 0);
  delay(1000);
}
